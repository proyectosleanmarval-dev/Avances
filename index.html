<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Sistema de Seguimiento de Proyectos</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
      background: #f7f9fc;
      margin: 0;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      margin-bottom: 30px;
      border-bottom: 2px solid #1f2937;
      padding-bottom: 20px;
    }

    h1 {
      color: #1f2937;
      margin: 0 0 20px 0;
      font-size: 24px;
      font-weight: normal;
    }

    .botones {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
    }

    .btn {
      padding: 12px 24px;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      background: #e5e7eb;
      color: #1f2937;
      transition: all 0.3s ease;
    }

    .btn:hover {
      background: #d1d5db;
    }

    .btn.activo {
      background: #1f2937;
      color: white;
    }

    .vista {
      display: none;
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .vista.activa {
      display: block;
    }

    .vista-blanca {
      min-height: 400px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #6b7280;
      font-size: 16px;
      border: 2px dashed #e5e7eb;
      border-radius: 8px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 20px;
      background: white;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }

    th {
      background: #1f2937;
      color: white;
      font-weight: normal;
    }

    td.proyecto {
      text-align: left;
      font-weight: bold;
      background: #f3f4f6;
    }

    td.atraso {
      background: #ffe5e5;
      color: #b30000;
      font-weight: bold;
    }

    #estado {
      color: #6b7280;
      text-align: center;
      padding: 40px;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>Sistema de Seguimiento de Proyectos</h1>
      
      <div class="botones">
        <button id="btnGrilla" class="btn">Actividades de Grilla</button>
        <button id="btnLastPlanner" class="btn">Avances Last Planner</button>
      </div>
    </div>

    <!-- Vista Actividades de Grilla -->
    <div id="vistaGrilla" class="vista">
      <div class="vista-blanca">
        Contenido de Actividades de Grilla
      </div>
    </div>

    <!-- Vista Avances Last Planner -->
    <div id="vistaLastPlanner" class="vista">
      <div id="estado">Cargando datos...</div>
      
      <table id="tabla" style="display:none;">
        <thead></thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    // Manejo de botones y vistas
    const btnGrilla = document.getElementById('btnGrilla');
    const btnLastPlanner = document.getElementById('btnLastPlanner');
    const vistaGrilla = document.getElementById('vistaGrilla');
    const vistaLastPlanner = document.getElementById('vistaLastPlanner');

    function activarVista(vistaActiva, botonActivo) {
      // Desactivar todas las vistas
      vistaGrilla.classList.remove('activa');
      vistaLastPlanner.classList.remove('activa');
      
      // Desactivar todos los botones
      btnGrilla.classList.remove('activo');
      btnLastPlanner.classList.remove('activo');
      
      // Activar la vista y botón seleccionados
      vistaActiva.classList.add('activa');
      botonActivo.classList.add('activo');
    }

    btnGrilla.addEventListener('click', () => {
      activarVista(vistaGrilla, btnGrilla);
    });

    btnLastPlanner.addEventListener('click', () => {
      activarVista(vistaLastPlanner, btnLastPlanner);
      // Cargar datos si es necesario
      if (!vistaLastPlanner.hasAttribute('data-cargado')) {
        cargarDatos();
        vistaLastPlanner.setAttribute('data-cargado', 'true');
      }
    });

    // Activar vista de Last Planner por defecto
    window.addEventListener('load', () => {
      activarVista(vistaLastPlanner, btnLastPlanner);
    });

    // Función cargarDatos (sin cambios, solo movida dentro del script)
    async function cargarDatos() {
      try {
        const response = await fetch('data/consolidado.json');
        if (!response.ok) throw new Error("No se pudo cargar el JSON");

        const data = await response.json();

        if (!Array.isArray(data) || data.length === 0) {
          document.getElementById("estado").innerText = "No hay datos disponibles.";
          return;
        }

        // Agrupar datos
        const proyectos = {};
        const mesesSet = new Set();

        data.forEach(d => {
          const proyecto = d.Proyecto;
          const mes = d.__archivo_origen.replace(".xlsx", "");
          mesesSet.add(mes);

          const base = new Date(d.Fecha_Base);
          const proyectada = new Date(d.Fecha_Proyectada);
          const diasAtraso = Math.round(
            (proyectada - base) / (1000 * 60 * 60 * 24)
          );

          if (!proyectos[proyecto]) {
            proyectos[proyecto] = {};
          }

          proyectos[proyecto][mes] = diasAtraso;
        });

        const meses = Array.from(mesesSet).sort();

        const thead = document.querySelector("#tabla thead");
        const tbody = document.querySelector("#tabla tbody");

        // Header
        let header = "<tr><th>Proyecto</th>";
        meses.forEach(m => header += `<th>${m}</th>`);
        header += "</tr>";
        thead.innerHTML = header;

        // Body
        let bodyHTML = "";

        for (const proyecto in proyectos) {
          bodyHTML += `<tr><td class="proyecto">${proyecto}</td>`;

          meses.forEach(m => {
            const valor = proyectos[proyecto][m] ?? 0;
            const clase = valor > 0 ? "atraso" : "";
            bodyHTML += `<td class="${clase}">${valor}</td>`;
          });

          bodyHTML += "</tr>";
        }

        tbody.innerHTML = bodyHTML;

        document.getElementById("estado").style.display = "none";
        document.getElementById("tabla").style.display = "table";

      } catch (error) {
        document.getElementById("estado").innerText =
          "Error cargando datos: " + error.message;
      }
    }
  </script>
</body>
</html>
